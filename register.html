<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>تسجيل منخرط جديد - نادي التايكوندو</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    body { font-family: 'Tajawal', sans-serif; }
    .upload-area{border:2px dashed #ccc;border-radius:8px;padding:20px;text-align:center;cursor:pointer}
    .upload-area:hover{border-color:#3b82f6;background:#ebf5ff}
    .preview-image{max-width:100%;max-height:200px;border-radius:8px;margin-top:10px;display:none}
  </style>
</head>
<body class="min-h-screen bg-gray-50">
  <div class="max-w-3xl mx-auto p-4">
    <header class="flex items-center justify-between mb-4">
      <div class="flex items-center gap-3">
        <img id="logo" src="https://i.imgur.com/gLiLcpa.png" class="w-12 h-12 rounded-full object-cover" alt="Logo" />
        <h1 class="text-xl font-bold">تسجيل منخرط جديد</h1>
      </div>
      <a href="/html" class="text-blue-600 hover:underline">العودة للنظام</a>
    </header>

    <div class="bg-white rounded-xl shadow p-4">
      <form id="reg-form" class="space-y-4">
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium mb-1">الاسم الكامل</label>
            <input id="name" required class="w-full px-3 py-2 border rounded" />
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">تاريخ الميلاد</label>
            <input id="birthDate" type="date" required class="w-full px-3 py-2 border rounded" />
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">الوزن (كغ)</label>
            <input id="weight" type="number" required class="w-full px-3 py-2 border rounded" />
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">الطول (سم)</label>
            <input id="height" type="number" required class="w-full px-3 py-2 border rounded" />
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">الجنس</label>
            <div class="flex gap-3">
              <label class="flex items-center gap-1"><input type="radio" name="gender" value="ذكر" checked /> ذكر</label>
              <label class="flex items-center gap-1"><input type="radio" name="gender" value="أنثى" /> أنثى</label>
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">رقم الهاتف</label>
            <input id="phone" required class="w-full px-3 py-2 border rounded" />
          </div>
          <div class="sm:col-span-2">
            <label class="block text-sm font-medium mb-1">العنوان</label>
            <input id="address" required class="w-full px-3 py-2 border rounded" />
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">رقم البطاقة الوطنية (CIN)</label>
            <input id="cin" class="w-full px-3 py-2 border rounded" placeholder="إذا كان متوفر" />
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">رقم عقد الازدياد</label>
            <input id="birthCertificate" class="w-full px-3 py-2 border rounded" placeholder="إذا لم يكن CIN متوفر" />
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium mb-1">صورة اللاعب</label>
          <div id="upload-area" class="upload-area">
            <i class="fas fa-cloud-upload-alt"></i>
            <p class="text-sm">انقر هنا لتحميل صورة أو اسحب وأفلت</p>
            <input id="photo" type="file" accept="image/*" class="hidden" />
            <img id="preview" class="preview-image" />
          </div>
        </div>

        <div class="pt-2 flex gap-2">
          <button class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded" type="submit">تسجيل</button>
          <button class="bg-gray-200 px-4 py-2 rounded" type="reset">مسح</button>
        </div>
      </form>
    </div>

    <p id="done" class="hidden mt-4 text-green-700 bg-green-100 border border-green-300 rounded px-3 py-2">تم التسجيل بنجاح! سيظهر المنخرط في النظام تلقائياً.</p>
  </div>

  <script>
    const LOGO_KEY = 'tkd_logo';
    const STORAGE_KEY = 'tkd_players';
    const logo = localStorage.getItem(LOGO_KEY); if (logo) document.getElementById('logo').src = logo;

    let photoData = null;
    const area = document.getElementById('upload-area');
    const input = document.getElementById('photo');
    const preview = document.getElementById('preview');
    area.addEventListener('click', ()=>input.click());
    area.addEventListener('dragover', e=>{e.preventDefault();});
    area.addEventListener('drop', e=>{e.preventDefault(); if(e.dataTransfer.files.length>0) handleFile(e.dataTransfer.files[0]);});
    input.addEventListener('change', e=>{ if(e.target.files.length>0) handleFile(e.target.files[0]); });
    function handleFile(file){ if(!file.type.startsWith('image/')) return; const r=new FileReader(); r.onload=e=>{photoData=e.target.result; preview.src=photoData; preview.style.display='block';}; r.readAsDataURL(file);} 

    document.getElementById('reg-form').addEventListener('submit', e=>{
      e.preventDefault();
      const form = {
        id: Date.now(),
        name: document.getElementById('name').value,
        birthDate: document.getElementById('birthDate').value,
        age: calcAge(document.getElementById('birthDate').value),
        weight: parseInt(document.getElementById('weight').value),
        height: parseInt(document.getElementById('height').value),
        gender: document.querySelector('input[name="gender"]:checked').value,
        level: 'أبيض',
        phone: document.getElementById('phone').value,
        address: document.getElementById('address').value,
        cin: document.getElementById('cin').value,
        birthCertificate: document.getElementById('birthCertificate').value,
        photo: photoData || 'https://placehold.co/100x100/4F46E5/FFFFFF?text=ج',
        completedMonths: [],
        insurance: 'لا',
        insuranceType: '',
        insuranceNumber: ''
      };
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        const list = raw ? JSON.parse(raw) : [];
        list.push(form);
        localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
        document.getElementById('done').classList.remove('hidden');
        e.target.reset();
        preview.style.display='none';
        photoData=null;
      } catch(err) {}
    });

    function calcAge(dateStr){ if(!dateStr) return 0; const t=new Date(); const b=new Date(dateStr); let a=t.getFullYear()-b.getFullYear(); const m=t.getMonth()-b.getMonth(); if(m<0||(m===0&&t.getDate()<b.getDate())) a--; return a; }
  </script>
</body>
</html>
